---
title: "クラスター分析"
output: html_document
---

```{r, message=FALSE}
library(tidyverse)
```

## クラスター分析とは何か

```{r}
name <- c('A', 'B', 'C', 'D')
x    <- c( 0,  -16,  10,  10)
y    <- c( 0,    0,  10, -15)

(points <- data.frame(x, y, row.names = name))
```

散布図を描く．

```{r}
plot(points, type = 'n')
text(x, y, name)
```

点同士の距離を求める．

```{r}
(my_dist <- dist(points))
```

距離の指標は他にもある．

```{r}
?dist
```

マンハッタン距離を試す．

```{r}
dist(points, method = "manhattan")
```

### 階層的クラスター分析

階層的クラスター分析を実行し，デンドログラムを描く．

```{r}
my_result <- hclust(my_dist)
plot(my_result, hang = -1)
```

描画時にクラスター数を指定する．

```{r}
plot(my_result, hang = -1)
rect.hclust(my_result, k = 2)
```

それぞれがどのクラスターに入ったのかを確認する．

```{r}
cutree(my_result, k = 2)
```

**練習：距離の指標をマンハッタン距離に変えて，階層的クラスター分析を実行してみよ．**

補足：クラスター間の距離の決め方が複数ある．

```{r}
?hclust
```

デフォルトは`complete`で，クラスター間の点同士の距離の最大値を使う．`single`にすると，クラスター間の点同士の最小値を使う．

```{r}
plot(hclust(my_dist, method = "single"), hang = -1)
```

### 非階層的クラスター分析（割愛）

## 練習：USA各州の犯罪数

```{r}
head(USArrests)
```

3列目を除外し，標準化する．

```{r}
my_data <- scale(USArrests[, -3])
head(my_data)
```

階層的クラスター分析

```{r}
my_dist <- dist(my_data)
my_result <- hclust(my_dist)
plot(my_result, hang = -1)
rect.hclust(my_result, k = 4)
```

```{r}
my_cluster <- cutree(my_result, k = 4)
```

主成分分析のバイプロットと合わせて描画する．

```{r}
my_prcomp <- prcomp(my_data, center = TRUE, scale = TRUE) # 主成分分析

library(ggbiplot)
ggbiplot(my_prcomp,
         labels = row.names(my_data),
         groups = as.factor(my_cluster), ellipse = TRUE)
```


**レポート課題14：MASS::Animalsの標準化したデータ（Brachiosaurusは除外）をクラスター分析し，5つのクラスターに分けてください．ただし，点同士の距離の指標（`dist()`の`method`で指定）や，クラスター同士の距離の指標（`hclust()`の`method`で指定）を変えて，Humanだけが入ったクラスターができないようにしてください．ヒント：データの準備の仕方を下に示します．**

```{r}
my_data <- MASS::Animals
my_data <- scale(my_data[row.names(my_data) != "Brachiosaurus",])
```
